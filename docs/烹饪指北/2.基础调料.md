# è°ƒæ–™

åœ¨è¿™éƒ¨åˆ†ï¼Œå¤šæ•°æ˜¯åšä¸€äº›åŸºç¡€é…ç½®ï¼ˆå¤šä¸ªé¡¹ç›®é€šç”¨çš„é…ç½®æŠ½è±¡å‡ºæ¥æˆä¸ºä¸€ä¸ªå­åŒ…ï¼‰ä»¥åŠç»„ç»‡å·¥ç¨‹ç»“æ„çš„æ“ä½œï¼Œ

- tsconfig
- lint-configs
  - eslint-config
  - prettier-config
  - commitlint-config
  - stylelint-config
- tailwind-config
- vite-config

å®ƒä»¬çš„ç»Ÿä¸€å‘½åæ ¼å¼ä¸ºï¼š`@o-oyic/xxx`

> å…¶ä¸­çš„tailwindå’Œviteçš„é…ç½®ï¼Œæˆ‘å…ˆå®šä¹‰å¥½äº†æ”¾åœ¨è¿™é‡Œï¼Œç­‰åˆ°éœ€è¦è¿™äº›å†…å®¹çš„å­åŒ…å¼€å§‹äº†ä¹‹åï¼Œæ‰åˆ°è¿™é‡Œåšé…ç½®ã€‚

## ç›®å½•ç»“æ„

åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå¹¶è®©å®ƒæˆä¸ºmonorepoå·¥ä½œåŒºï¼Œå¹¶åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º`pnpm-workspace.yaml`æ–‡ä»¶ï¼š

```yaml
packages:
  - 'apps/*'
  - 'packages/*'
  - 'internal/*'
  - 'docs/*'
```

ä¹Ÿå°±æ˜¯éœ€è¦åˆ›å»ºä¸Šé¢çš„è¿™ä¹ˆå¤šä¸ªå­åŒ…å—·

### å·¥ä½œåŒº

æ·»åŠ ä¸€ä¸ªå·¥ä½œåŒºçš„é…ç½®æ–‡ä»¶ï¼Œä¸ºäº†å¥½æ‰¾ï¼Œä¹Ÿä¸ºäº†æœ‰ä¸ªæ˜ å°„å…³ç³»ï¼Œç›´æ¥åˆ›å»ºä¸€âœ‹ğŸ»å·¥ä½œåŒºæ–‡ä»¶ï¼šo-oyic.code-workspaceï¼Œå°†ç›®å‰å·²æœ‰çš„æˆ–åœ¨è®¡åˆ’ä¸­çš„å­åŒ…æ”¾è¿›å»ï¼ˆæ²¡æœ‰çš„åé¢å†è¡¥å—·ï¼‰

```json
{
  "folders": [
    {
      "name": "@o-oyic/tsconfig",
      "path": "internal/lint-config/tsconfig"
    },
    {
      "name": "@o-oyic/eslint-config",
      "path": "internal/lint-config/eslint-config"
    }
  ]
}
```

## åŸºç¡€é…ç½®

### tsconfig

ç”±ä¸€å †jsonæ–‡ä»¶ç»„æˆï¼Œä¸éœ€è¦æ‰“åŒ…æ„å»ºï¼Œç›´æ¥åœ¨`package.json`ä¸­å®šä¹‰å¯¼å‡ºæ–‡ä»¶çš„åˆ—è¡¨å³å¯

### lint-configs

linté¡¹ç›®æ˜¯å¤šä¸ªé…ç½®çš„é›†åˆï¼ŒåŒ…å«äº†ï¼š

- eslint
- prettier
- stylelint
- commitlint

åœ¨è¿™ä¸ªç¯èŠ‚å®šä¹‰çš„linté…ç½®ï¼Œéœ€è¦æ³¨æ„ä¸¤ç‚¹ï¼š

- éœ€è¦åœ¨çˆ¶åŒ…çš„package.jsonä¸­å®šä¹‰å…¬å…±åŒ…ï¼Œå­åŒ…çš„nameè¦å’Œçˆ¶åŒ…å¯¹åº”ä¸Š

```json
{
  "dependencies": {
    // ...
    "@o-oyic/eslint-config": "workspace:*",
    "@o-oyic/prettier-config": "workspace:*",
    "@o-oyic/stylelint-config": "workspace:*",
    "@o-oyic/commitlint-config": "workspace:*"
  }
}
```

- åœ¨å­åŒ…å†…è¦æ³¨æ„å¯¼å‡ºçš„æ–‡ä»¶

```json
{
  "name": "@o-oyic/xxx-config",
  "main": "${path}", // path ä¸ºå®é™…å¯¼å‡ºæ–‡ä»¶è·¯å¾„
  "module": "${path}",
  "types": "${path}",
  "exports": {
    ".": {
      "import": "${path}",
      "require": "${path}"
    }
  }
}
```

éœ€è¦å®šä¹‰çš„é…ç½®ï¼š

- javascript
- typescript
- vue
- react
- command
- import
- ignore

ç»Ÿä¸€ç”¨`interopDefault`æ–¹æ³•å¯¼å…¥ä¾èµ–ï¼Œè¿”å›`Promise`ï¼Œåœ¨å…¥å£å¤„`index`æ–‡ä»¶ç»Ÿä¸€å¯¼å‡º

é¡¹ç›®åœ¨è¿è¡Œ`pnpm install`çš„æ—¶å€™ï¼Œå¯ä»¥åˆ©ç”¨`pnpm`çš„ç”Ÿå‘½å‘¨æœŸï¼š

- preinstallï¼šåœ¨å®‰è£…ä¾èµ–é¡¹ä¹‹å‰è¿è¡Œã€‚
- installï¼šåœ¨å®‰è£…ä¾èµ–é¡¹æ—¶è¿è¡Œã€‚
- postinstallï¼šåœ¨å®‰è£…ä¾èµ–é¡¹ä¹‹åè¿è¡Œã€‚

åœ¨`postinstall`è¿›è¡Œå·¥ä½œåŒºçš„ä¾èµ–æ„å»ºï¼Œåœ¨ä¸»åŒ…çš„`package.json`é‡Œé¢å®šä¹‰è„šæœ¬

```json
{
  "scripts": {
    "preinstall": "npx only-allow pnpm", // åªå…è®¸ä½¿ç”¨pnpm
    // install å®‰è£…ä¾èµ–
    "postinstall": "pnpm -r run stub --if-present" // è¿è¡Œå­åŒ…çš„stubè„šæœ¬
  }
}
```

åœ¨å®‰è£…ä¾èµ–çš„å‰ååšä¸€äº›å‡†å¤‡å·¥ä½œï¼š

- å®‰è£…å‰åªå…è®¸pnpmä½œä¸ºåŒ…ç®¡ç†å·¥å…·
- é€šè¿‡å·¥ä½œåŒºçš„ä¾èµ–`"@o-oyic/eslint-config": "workspace:*"`ï¼Œå°†å­åŒ…ä½œä¸ºä¾èµ–å®‰è£…åœ¨å·¥ä½œåŒºï¼š`node_modules/@o-oyic/xxx`
- å®‰è£…åè¿è¡Œå­åŒ…çš„çš„`stub`è„šæœ¬ï¼Œä¼šå°†`lint`ä¸‹éœ€è¦æ„å»ºçš„å­åŒ…æ‰“åŒ…æ„å»ºåœ¨å·¥ä½œåŒº

### é›†æˆHuskyï¼ˆå“ˆæ’’ç»™ï¼‰

åœ¨æäº¤æˆ–æ¨é€æ—¶è‡ªåŠ¨æ£€æŸ¥ä½ çš„æäº¤æ¶ˆæ¯ã€ä»£ç å¹¶è¿è¡Œæµ‹è¯•ï¼Œå‘ç”Ÿé”™è¯¯æ—¶é˜»æ­¢æäº¤æˆ–æ¨é€ã€‚

#### åˆå§‹åŒ–

```shell
pnpm exec husky init
```

å®ƒåœ¨ .husky/ ä¸­åˆ›å»ºä¸€ä¸ª pre-commit è„šæœ¬ï¼Œå¹¶åœ¨ package.json ä¸­æ›´æ–° prepare è„šæœ¬ã€‚

åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œå†åšå¤šç‚¹æ£€æŸ¥ï¼Œåé¢è¿™ä¸ªé¡¹ç›®æ˜¯ä¼šä¸ŠCI/CDçš„ï¼Œæˆ‘å¸Œæœ›åªåœ¨æœ¬åœ°çš„ç¯å¢ƒä¸Šï¼Œè¿›è¡Œæ ¡éªŒï¼Œåœ¨CIçš„ç¯å¢ƒä¸Šï¼Œä¸åšæ ¡éªŒ

éœ€è¦æ›´æ–° prepare è„šæœ¬ï¼ŒåŠ ä¸Šæ ¡éªŒCIç¯å¢ƒçš„å‘½ä»¤

```json
{
  "scripts": {
    "prepare": "is-ci || husky"
  }
}
```

### ç¼–å†™è„šæœ¬æ‰§è¡Œlint

ç¼–å†™è„šæœ¬æ‰§è¡Œlintï¼Œè„šæœ¬ç›¸å…³çš„å†…å®¹ä¼šå®šä¹‰åœ¨`scripts`å­åŒ…å†…ï¼Œè¿™é‡Œé¢ä¼šæ”¾ä¸€äº›å…³äºæ„å»ºæ‰“åŒ…éƒ¨ç½²çš„è„šæœ¬ä¸€ç±»çš„æ–‡ä»¶

cliè„šæœ¬ä¸»è¦çš„æ€è·¯æœ‰ï¼š

- lint
- update version
- deploy

åœ¨linté˜¶æ®µï¼Œæˆ‘ä»¬ä½¿ç”¨å¯æ‰§è¡Œè„šæœ¬çš„æ–¹å¼ï¼Œå°†å‘½ä»¤æš´æ¼å‡ºå»ç»™åˆ°é¡¶å±‚åŒ…å»ä½¿ç”¨ï¼Œè‡³äºæ€ä¹ˆç¼–å†™å¯æ‰§è¡Œè„šæœ¬ï¼Œä½ èˆ…æƒ³å§

éœ€è¦åœ¨cliæä¾›binæ–‡ä»¶ã€lintè„šæœ¬ã€unbuildæ„å»ºæ–‡ä»¶

```js
#!/usr/bin/env node

import('../dist/index.mjs');
```

æˆ‘å°†ä¸€ç³»åˆ—çš„cliè„šæœ¬å‘½åä¸ºociï¼ˆo-oyci CLIï¼‰

æ‰€ä»¥åœ¨é¡¶å±‚çš„package.jsonå°±è¦ç”¨ociæ¥æ‰§è¡Œè„šæœ¬

```json
{
  // ...
  "scripts": {
    //...
    "lint": "oci lint",
    "format": "oci lint --format"
  }
}
```

åˆ°ç›®å‰ä¸ºæ­¢å·²ç»å‡†å¤‡äº†å¯æ‰§è¡Œè„šæœ¬ï¼ˆbinï¼‰ã€lintè„šæœ¬ï¼Œæ¥ä¸‹æ¥æ˜¯ç»“åˆ commitlint + lint-staged + huskyï¼Œåœ¨æäº¤å‰è¿›è¡Œlintæ£€æŸ¥

#### lint-staged

è¿™æ˜¯é’ˆå¯¹æš‚å­˜åŒºçš„æ–‡ä»¶è¿›è¡Œlintçš„æ’ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬æäº¤ä¸€æ¬¡ï¼Œä¸éœ€è¦æ›´æ”¹å…¨éƒ¨æ–‡ä»¶ï¼Œå¤ªè€—æ—¶ä¸”å®¹æ˜“æ”¹åå…¶ä»–æ–‡ä»¶çš„æ ¼å¼

åŒæ ·çš„é…æ–¹ï¼Œéœ€è¦åœ¨é¡¶å±‚å®šä¹‰é…ç½®æ–‡ä»¶`.lintstagedrc.mjs`

ç„¶åæˆ‘ä»¬å°±å¯ä»¥å¯¹æš‚å­˜åŒºçš„æ–‡ä»¶è¿›è¡Œæ ¡éªŒï¼Œè¿™ä¸ªæ’ä»¶ç›´æ¥æ‰§è¡Œå‘½ä»¤ `pnpm exec lint-staged`

ä½†æ˜¯ä¸ºäº†ç»“åˆæäº¤å‰çš„æš‚å­˜åŒºæ ¡éªŒï¼Œæˆ‘ä»¬è¦å°†è¿™æ¡å‘½ä»¤å†™å…¥ huskyçš„`pre-commit`é‡Œé¢

#### commitlint

ä¾ç„¶æ˜¯åœ¨lint-configå®šä¹‰è„šæœ¬ï¼Œç„¶åå¯¼å‡º

æ¥ç€åœ¨é¡¶å±‚å®šä¹‰é…ç½®æ–‡ä»¶`.commitlintrc.mjs`

#### pre-commit

åœ¨åˆå§‹åŒ–huskyçš„æ—¶å€™ï¼Œå®ƒå·²ç»å¸®æˆ‘ä»¬ç”Ÿæˆäº†é…ç½®æ–‡ä»¶`.husky/pre-commit`

æˆ‘ä»¬åœ¨é‡Œé¢ä½¿ç”¨ä¸Šéœ€è¦çš„å‘½ä»¤ï¼ŒåŒ…å«äº†update versionã€lint-staged

```shell
pnpm exec lint-staged
```

è¿˜æ²¡å®Œï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†æäº¤æ–¹å¼ä¹Ÿæ›´æ”¹ä¸‹ï¼Œéœ€è¦åœ¨é¡¶å±‚çš„package.jsonä¿®æ”¹ä¸€ä¸‹é…ç½®

```json
{
  //...
  "config": {
    "commitizen": {
      "path": "node_modules/cz-git"
    }
  }
}
```

å°†gitæäº¤æ–¹å¼äº¤ç»™cz-gitæ¥æ‰˜ç®¡ï¼Œå®ƒä¼šæ‹¦æˆªæˆ‘ä»¬çš„æäº¤ï¼ŒæŒ‰ç…§commitlintå®šä¹‰çš„è§„èŒƒå»ä¸€æ­¥æ­¥å®Œæˆæäº¤

æœ€åï¼Œå®šä¹‰è„šæœ¬ï¼Œæ¯æ¬¡åœ¨commitæ–‡ä»¶çš„æ—¶å€™ï¼Œè¿è¡Œå‘½ä»¤ï¼š`pnpm commit`ï¼Œå°±å¯ä»¥è¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„æœ€ç»ˆæ•ˆæœ

```json
{
  "scripts": {
    //...
    "commit": "git-cz"
  }
}
```

æ­¤è‡´ï¼Œæ•´ä¸ªé¡¹ç›®æ¶æ„çš„è°ƒæ–™å·²ç»å‡†å¤‡å®Œæˆï¼Œæ¥ä¸‹æ¥æ˜¯ èŒèŒè¿›æ”» åŸºå»ºæ”¯æŒäº†
