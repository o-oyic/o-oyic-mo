# è°ƒæ–™

åœ¨è¿™éƒ¨åˆ†ï¼Œå¤šæ•°æ˜¯åšä¸€äº›åŸºç¡€é…ç½®ï¼ˆå¤šä¸ªé¡¹ç›®é€šç”¨çš„é…ç½®æŠ½è±¡å‡ºæ¥æˆä¸ºä¸€ä¸ªå­åŒ…ï¼‰ä»¥åŠç»„ç»‡å·¥ç¨‹ç»“æ„çš„æ“ä½œï¼Œ

- tsconfig
- lint-configs
  - eslint-config
  - prettier-config
  - commitlint-config
  - stylelint-config
- tailwind-config
- vite-config

å®ƒä»¬çš„ç»Ÿä¸€å‘½åæ ¼å¼ä¸ºï¼š`@o-oyic/xxx`

> å…¶ä¸­çš„tailwindå’Œviteçš„é…ç½®ï¼Œæˆ‘å…ˆå®šä¹‰å¥½äº†æ”¾åœ¨è¿™é‡Œï¼Œç­‰åˆ°éœ€è¦è¿™äº›å†…å®¹çš„å­åŒ…å¼€å§‹äº†ä¹‹åï¼Œæ‰åˆ°è¿™é‡Œåšé…ç½®ã€‚

## ç›®å½•ç»“æ„

åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå¹¶è®©å®ƒæˆä¸ºmonorepoå·¥ä½œåŒºï¼Œå¹¶åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º`pnpm-workspace.yaml`æ–‡ä»¶ï¼š

```yaml
packages:
  - 'apps/*'
  - 'packages/*'
  - 'internal/*'
  - 'docs/*'
```

ä¹Ÿå°±æ˜¯éœ€è¦åˆ›å»ºä¸Šé¢çš„è¿™ä¹ˆå¤šä¸ªå­åŒ…å—·

### å·¥ä½œåŒº

æ·»åŠ ä¸€ä¸ªå·¥ä½œåŒºçš„é…ç½®æ–‡ä»¶ï¼Œä¸ºäº†å¥½æ‰¾ï¼Œä¹Ÿä¸ºäº†æœ‰ä¸ªæ˜ å°„å…³ç³»ï¼Œç›´æ¥åˆ›å»ºä¸€âœ‹ğŸ»å·¥ä½œåŒºæ–‡ä»¶ï¼šo-oyic.code-workspaceï¼Œå°†ç›®å‰å·²æœ‰çš„æˆ–åœ¨è®¡åˆ’ä¸­çš„å­åŒ…æ”¾è¿›å»ï¼ˆæ²¡æœ‰çš„åé¢å†è¡¥å—·ï¼‰

```json
{
  "folders": [
    {
      "name": "@o-oyic/tsconfig",
      "path": "internal/lint-config/tsconfig"
    },
    {
      "name": "@o-oyic/eslint-config",
      "path": "internal/lint-config/eslint-config"
    }
  ]
}
```

## åŸºç¡€é…ç½®

### tsconfig

ç”±ä¸€å †jsonæ–‡ä»¶ç»„æˆï¼Œä¸éœ€è¦æ‰“åŒ…æ„å»ºï¼Œç›´æ¥åœ¨`package.json`ä¸­å®šä¹‰å¯¼å‡ºæ–‡ä»¶çš„åˆ—è¡¨å³å¯

### lint-configs

linté¡¹ç›®æ˜¯å¤šä¸ªé…ç½®çš„é›†åˆï¼ŒåŒ…å«äº†ï¼š

- eslint
- prettier
- stylelint
- commitlint

åœ¨è¿™ä¸ªç¯èŠ‚å®šä¹‰çš„linté…ç½®ï¼Œéœ€è¦æ³¨æ„ä¸¤ç‚¹ï¼š

- éœ€è¦åœ¨çˆ¶åŒ…çš„package.jsonä¸­å®šä¹‰å…¬å…±åŒ…ï¼Œå­åŒ…çš„nameè¦å’Œçˆ¶åŒ…å¯¹åº”ä¸Š

```json
{
  "dependencies": {
    // ...
    "@o-oyic/eslint-config": "workspace:*",
    "@o-oyic/prettier-config": "workspace:*",
    "@o-oyic/stylelint-config": "workspace:*",
    "@o-oyic/commitlint-config": "workspace:*"
  }
}
```

- åœ¨å­åŒ…å†…è¦æ³¨æ„å¯¼å‡ºçš„æ–‡ä»¶

```json
{
  "name": "@o-oyic/xxx-config",
  "main": "${path}", // path ä¸ºå®é™…å¯¼å‡ºæ–‡ä»¶è·¯å¾„
  "module": "${path}",
  "types": "${path}",
  "exports": {
    ".": {
      "import": "${path}",
      "require": "${path}"
    }
  }
}
```

éœ€è¦å®šä¹‰çš„é…ç½®ï¼š

- javascript
- typescript
- vue
- react
- command
- import
- ignore

ç»Ÿä¸€ç”¨`interopDefault`æ–¹æ³•å¯¼å…¥ä¾èµ–ï¼Œè¿”å›`Promise`ï¼Œåœ¨å…¥å£å¤„`index`æ–‡ä»¶ç»Ÿä¸€å¯¼å‡º

é¡¹ç›®åœ¨è¿è¡Œ`pnpm install`çš„æ—¶å€™ï¼Œå¯ä»¥åˆ©ç”¨`pnpm`çš„ç”Ÿå‘½å‘¨æœŸï¼š

- preinstallï¼šåœ¨å®‰è£…ä¾èµ–é¡¹ä¹‹å‰è¿è¡Œã€‚
- installï¼šåœ¨å®‰è£…ä¾èµ–é¡¹æ—¶è¿è¡Œã€‚
- postinstallï¼šåœ¨å®‰è£…ä¾èµ–é¡¹ä¹‹åè¿è¡Œã€‚

åœ¨`postinstall`è¿›è¡Œå·¥ä½œåŒºçš„ä¾èµ–æ„å»ºï¼Œåœ¨ä¸»åŒ…çš„`package.json`é‡Œé¢å®šä¹‰è„šæœ¬

```json
{
  "scripts": {
    "preinstall": "npx only-allow pnpm", // åªå…è®¸ä½¿ç”¨pnpm
    // install å®‰è£…ä¾èµ–
    "postinstall": "pnpm -r run stub --if-present" // è¿è¡Œå­åŒ…çš„stubè„šæœ¬
  }
}
```

åœ¨å®‰è£…ä¾èµ–çš„å‰ååšä¸€äº›å‡†å¤‡å·¥ä½œï¼š

- å®‰è£…å‰åªå…è®¸pnpmä½œä¸ºåŒ…ç®¡ç†å·¥å…·
- é€šè¿‡å·¥ä½œåŒºçš„ä¾èµ–`"@o-oyic/eslint-config": "workspace:*"`ï¼Œå°†å­åŒ…ä½œä¸ºä¾èµ–å®‰è£…åœ¨å·¥ä½œåŒºï¼š`node_modules/@o-oyic/xxx`
- å®‰è£…åè¿è¡Œå­åŒ…çš„çš„`stub`è„šæœ¬ï¼Œä¼šå°†`lint`ä¸‹éœ€è¦æ„å»ºçš„å­åŒ…æ‰“åŒ…æ„å»ºåœ¨å·¥ä½œåŒº

### é›†æˆHuskyï¼ˆå“ˆæ’’ç»™ï¼‰

åœ¨æäº¤æˆ–æ¨é€æ—¶è‡ªåŠ¨æ£€æŸ¥ä½ çš„æäº¤æ¶ˆæ¯ã€ä»£ç å¹¶è¿è¡Œæµ‹è¯•ï¼Œå‘ç”Ÿé”™è¯¯æ—¶é˜»æ­¢æäº¤æˆ–æ¨é€ã€‚

#### åˆå§‹åŒ–

```shell
pnpm exec husky init
```

å®ƒåœ¨ .husky/ ä¸­åˆ›å»ºä¸€ä¸ª pre-commit è„šæœ¬ï¼Œå¹¶åœ¨ package.json ä¸­æ›´æ–° prepare è„šæœ¬ã€‚

åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œå†åšå¤šç‚¹æ£€æŸ¥ï¼Œåé¢è¿™ä¸ªé¡¹ç›®æ˜¯ä¼šä¸ŠCI/CDçš„ï¼Œæˆ‘å¸Œæœ›åªåœ¨æœ¬åœ°çš„ç¯å¢ƒä¸Šï¼Œè¿›è¡Œæ ¡éªŒï¼Œåœ¨CIçš„ç¯å¢ƒä¸Šï¼Œä¸åšæ ¡éªŒ

éœ€è¦æ›´æ–° prepare è„šæœ¬ï¼ŒåŠ ä¸Šæ ¡éªŒCIç¯å¢ƒçš„å‘½ä»¤

```json
{
  "scripts": {
    "prepare": "is-ci || husky"
  }
}
```

TODO å¾…ç»­

- [ ] åœ¨huskyçš„pre-commitè„šæœ¬åŠ å…¥å‰ç½®æ ¡éªŒå‘½ä»¤
